
================================================================================
ğŸ§ª REPAIR-PASS TEST RUN - individuell & darlehen (DIRECT FUNCTION CALL)
================================================================================
ğŸ“… Run Label: staging-repair-pass-direct-2025-11-07
ğŸ§ª Total Tests: 6

âœ… MongoDB verbunden


ğŸš€ Starte Test: individuell (standard)
ğŸš€ V2 Zwei-Phasen-Generierung gestartet
ğŸ“‹ Vertragstyp: individuell
ğŸ‘¤ User ID (hash): 507f1f77...
ğŸ“Š Input (sanitiert): { parteiA: { exists: true }, parteiB: { exists: true } }
ğŸ¯ Quality Threshold: 0.9
ğŸ”„ Phase 1: Meta-Prompt Generation gestartet
ğŸ“‹ Vertragstyp: individuell
ğŸ‘¥ Rollen: { A: 'Partei A', B: 'Partei B' }
ğŸ“Š Input (sanitiert): { parteiA: { exists: true }, parteiB: { exists: true } }
âœ… Phase 1 erfolgreich: {
  promptLength: 1026,
  snapshotKeys: [ 'roles', 'mustClauses', 'forbiddenTopics', 'customRequirements' ],
  timingMs: 9717,
  tokens: 1562
}
ğŸ”„ Phase 2: Contract Generation gestartet
ğŸ“ Prompt-LÃ¤nge: 1026
âœ… Phase 2 erfolgreich: {
  textMetadata: {
    length: 3490,
    paragraphCount: 10,
    preview: '**Vertrag**\n' +
      '\n' +
      'zwischen\n' +
      '\n' +
      'Partei A: [NAME], HauptstraÃŸe 1, 10115 Berlin\n' +
      '\n' +
      'und\n' +
      '\n' +
      'Partei B: [NAME], Nebenst...'
  },
  timingMs: 9711,
  tokens: 1115
}
ğŸ”§ Repair-Pass gestartet fÃ¼r: individuell
âœ… Universal Repair abgeschlossen: { originalLength: 3490, repairedLength: 3490, tokens: 2283 }
ğŸ”§ Individuell-Typ erkannt, starte Spezialisierung...
âœ… Individuell Specialization abgeschlossen: { tokens: 1961 }
âœ… Repair-Pass abgeschlossen in 12792ms
ğŸ” Validator gestartet (deterministisch)
âœ… Validator abgeschlossen: { passed: true, score: 1, errorsCount: 0, warningsCount: 0 }
ğŸ” Self-Check gestartet
âœ… Self-Check abgeschlossen: { conforms: false, score: 0.8, notesCount: 4 }
ğŸ“Š Hybrid Score: 0.94 (Validator: 1, LLM: 0.8)
âœ… Generierung (sanitiert) in MongoDB gespeichert: new ObjectId('690e07773af8b8273a9c2cac')
âœ… Sichere Artefakte (verschlÃ¼sselt) gespeichert
ğŸ‰ V2 Generierung abgeschlossen: {
  durationMs: 34879,
  hybridScore: 0.94,
  validatorScore: 1,
  llmScore: 0.8,
  validatorPassed: true,
  retriesUsed: 0,
  reviewRequired: false,
  contractMetadata: {
    length: 3490,
    paragraphCount: 10,
    preview: '**Vertrag**\n' +
      '\n' +
      'zwischen\n' +
      '\n' +
      'Partei A: [NAME], HauptstraÃŸe 1, 10115 Berlin\n' +
      '\n' +
      'und\n' +
      '\n' +
      'Partei B: [NAME], Nebenst...'
  }
}
   âŒ individuell (standard): Cannot read properties of undefined (reading 'toFixed')

ğŸš€ Starte Test: individuell (sonderklausel)
ğŸš€ V2 Zwei-Phasen-Generierung gestartet
ğŸ“‹ Vertragstyp: individuell
ğŸ‘¤ User ID (hash): 507f1f77...
ğŸ“Š Input (sanitiert): {
  parteiA: { exists: true },
  parteiB: { exists: true },
  customRequirements: { length: 227 }
}
ğŸ¯ Quality Threshold: 0.9
ğŸ”„ Phase 1: Meta-Prompt Generation gestartet
ğŸ“‹ Vertragstyp: individuell
ğŸ‘¥ Rollen: { A: 'Partei A', B: 'Partei B' }
ğŸ“Š Input (sanitiert): {
  parteiA: { exists: true },
  parteiB: { exists: true },
  customRequirements: { length: 227 }
}
âœ… Phase 1 erfolgreich: {
  promptLength: 1206,
  snapshotKeys: [ 'roles', 'mustClauses', 'forbiddenTopics', 'customRequirements' ],
  timingMs: 14484,
  tokens: 1728
}
ğŸ”„ Phase 2: Contract Generation gestartet
ğŸ“ Prompt-LÃ¤nge: 1206
âœ… Phase 2 erfolgreich: {
  textMetadata: {
    length: 2930,
    paragraphCount: 11,
    preview: '**Vertrag nach BGB**\n' +
      '\n' +
      'zwischen\n' +
      '\n' +
      'Partei A: [NAME], Projektweg 10, 50667 KÃ¶ln\n' +
      '\n' +
      'und\n' +
      '\n' +
      'Partei B: [NAME], ...'
  },
  timingMs: 13371,
  tokens: 1056
}
ğŸ”§ Repair-Pass gestartet fÃ¼r: individuell
âœ… Universal Repair abgeschlossen: { originalLength: 2930, repairedLength: 2930, tokens: 2140 }
ğŸ”§ Individuell-Typ erkannt, starte Spezialisierung...
âœ… Individuell Specialization abgeschlossen: { tokens: 1779 }
âœ… Repair-Pass abgeschlossen in 9049ms
ğŸ” Validator gestartet (deterministisch)
âœ… Validator abgeschlossen: { passed: true, score: 0.9, errorsCount: 0, warningsCount: 1 }
ğŸ” Self-Check gestartet
âœ… Self-Check abgeschlossen: { conforms: true, score: 1, notesCount: 0 }
ğŸ“Š Hybrid Score: 0.93 (Validator: 0.9, LLM: 1)
âœ… Generierung (sanitiert) in MongoDB gespeichert: new ObjectId('690e079e3af8b8273a9c2cae')
âœ… Sichere Artefakte (verschlÃ¼sselt) gespeichert
ğŸ‰ V2 Generierung abgeschlossen: {
  durationMs: 38103,
  hybridScore: 0.93,
  validatorScore: 0.9,
  llmScore: 1,
  validatorPassed: true,
  retriesUsed: 0,
  reviewRequired: false,
  contractMetadata: {
    length: 2814,
    paragraphCount: 11,
    preview: '**Vertrag nach BGB**\n' +
      '\n' +
      'zwischen\n' +
      '\n' +
      'Partei A: [NAME], Projektweg 10, 50667 KÃ¶ln\n' +
      '\n' +
      'und\n' +
      '\n' +
      'Partei B: [NAME], ...'
  }
}
   âŒ individuell (sonderklausel): Cannot read properties of undefined (reading 'toFixed')

ğŸš€ Starte Test: individuell (edge_case)
ğŸš€ V2 Zwei-Phasen-Generierung gestartet
ğŸ“‹ Vertragstyp: individuell
ğŸ‘¤ User ID (hash): 507f1f77...
ğŸ“Š Input (sanitiert): {
  parteiA: { exists: true },
  parteiB: { exists: true },
  customRequirements: { length: 51 }
}
ğŸ¯ Quality Threshold: 0.9
ğŸ”„ Phase 1: Meta-Prompt Generation gestartet
ğŸ“‹ Vertragstyp: individuell
ğŸ‘¥ Rollen: { A: 'Partei A', B: 'Partei B' }
ğŸ“Š Input (sanitiert): {
  parteiA: { exists: true },
  parteiB: { exists: true },
  customRequirements: { length: 51 }
}
âœ… Phase 1 erfolgreich: {
  promptLength: 1582,
  snapshotKeys: [ 'roles', 'mustClauses', 'forbiddenTopics', 'customRequirements' ],
  timingMs: 17586,
  tokens: 1960
}
ğŸ”„ Phase 2: Contract Generation gestartet
ğŸ“ Prompt-LÃ¤nge: 1582
âœ… Phase 2 erfolgreich: {
  textMetadata: {
    length: 3242,
    paragraphCount: 10,
    preview: '**Vertrag zwischen Partei A und Partei B**\n' +
      '\n' +
      'zwischen\n' +
      '\n' +
      'Partei A: [NAME], TeststraÃŸe 1, 12345 Stadt\n' +
      '\n' +
      'u...'
  },
  timingMs: 13188,
  tokens: 1210
}
ğŸ”§ Repair-Pass gestartet fÃ¼r: individuell
âœ… Universal Repair abgeschlossen: { originalLength: 3242, repairedLength: 3242, tokens: 2313 }
ğŸ”§ Individuell-Typ erkannt, starte Spezialisierung...
âœ… Individuell Specialization abgeschlossen: { tokens: 1983 }
âœ… Repair-Pass abgeschlossen in 10288ms
ğŸ” Validator gestartet (deterministisch)
âœ… Validator abgeschlossen: { passed: true, score: 1, errorsCount: 0, warningsCount: 0 }
ğŸ” Self-Check gestartet
âœ… Self-Check abgeschlossen: { conforms: false, score: 0.8, notesCount: 5 }
ğŸ“Š Hybrid Score: 0.94 (Validator: 1, LLM: 0.8)
âœ… Generierung (sanitiert) in MongoDB gespeichert: new ObjectId('690e07cb3af8b8273a9c2cb0')
âœ… Sichere Artefakte (verschlÃ¼sselt) gespeichert
ğŸ‰ V2 Generierung abgeschlossen: {
  durationMs: 44588,
  hybridScore: 0.94,
  validatorScore: 1,
  llmScore: 0.8,
  validatorPassed: true,
  retriesUsed: 0,
  reviewRequired: false,
  contractMetadata: {
    length: 3206,
    paragraphCount: 10,
    preview: '**Vertrag zwischen Partei A und Partei B**\n' +
      '\n' +
      'zwischen\n' +
      '\n' +
      'Partei A: [NAME], TeststraÃŸe 1, 12345 Stadt\n' +
      '\n' +
      'u...'
  }
}
   âŒ individuell (edge_case): Cannot read properties of undefined (reading 'toFixed')

ğŸš€ Starte Test: darlehen (standard)
ğŸš€ V2 Zwei-Phasen-Generierung gestartet
ğŸ“‹ Vertragstyp: darlehen
ğŸ‘¤ User ID (hash): 507f1f77...
ğŸ“Š Input (sanitiert): {
  parteiA: { exists: true },
  parteiB: { exists: true },
  customRequirements: { length: 135 }
}
ğŸ¯ Quality Threshold: 0.94
ğŸ”„ Phase 1: Meta-Prompt Generation gestartet
ğŸ“‹ Vertragstyp: darlehen
ğŸ‘¥ Rollen: { A: 'Darlehensgeber', B: 'Darlehensnehmer' }
ğŸ“Š Input (sanitiert): {
  parteiA: { exists: true },
  parteiB: { exists: true },
  customRequirements: { length: 135 }
}
âœ… Phase 1 erfolgreich: {
  promptLength: 1649,
  snapshotKeys: [ 'roles', 'mustClauses', 'forbiddenTopics', 'customRequirements' ],
  timingMs: 16531,
  tokens: 2147
}
ğŸ”„ Phase 2: Contract Generation gestartet
ğŸ“ Prompt-LÃ¤nge: 1649
âœ… Phase 2 erfolgreich: {
  textMetadata: {
    length: 2858,
    paragraphCount: 12,
    preview: '**Darlehensvertrag**\n' +
      '\n' +
      'zwischen\n' +
      '\n' +
      '**Darlehensgeber:** [NAME], BankstraÃŸe 10, 60311 Frankfurt\n' +
      '\n' +
      'und\n' +
      '\n' +
      '**D...'
  },
  timingMs: 14805,
  tokens: 1225
}
ğŸ”§ Repair-Pass gestartet fÃ¼r: darlehen
âœ… Universal Repair abgeschlossen: { originalLength: 2858, repairedLength: 2858, tokens: 2244 }
âœ… Repair-Pass abgeschlossen in 3348ms
ğŸ” Validator gestartet (deterministisch)
âœ… Validator abgeschlossen: { passed: true, score: 0.9, errorsCount: 0, warningsCount: 1 }
ğŸ” Self-Check gestartet
âœ… Self-Check abgeschlossen: { conforms: false, score: 0.8, notesCount: 5 }
ğŸ“Š Hybrid Score: 0.87 (Validator: 0.9, LLM: 0.8)
âš ï¸ Hybrid Score (0.87) < Threshold (0.94), starte Retry 1/2 (Backoff: 1000ms)...
ğŸ”§ Repair-Pass gestartet fÃ¼r: darlehen
âœ… Universal Repair abgeschlossen: { originalLength: 3058, repairedLength: 3058, tokens: 2339 }
âœ… Repair-Pass abgeschlossen in 3518ms
ğŸ” Validator gestartet (deterministisch)
âœ… Validator abgeschlossen: { passed: true, score: 0.9, errorsCount: 0, warningsCount: 1 }
ğŸ” Self-Check gestartet
âœ… Self-Check abgeschlossen: { conforms: true, score: 1, notesCount: 0 }
ğŸ”„ Retry 1 Hybrid Score: 0.93 (Validator: 0.9, LLM: 1)
âš ï¸ Hybrid Score (0.93) < Threshold (0.94), starte Retry 2/2 (Backoff: 2000ms)...
ğŸ”§ Repair-Pass gestartet fÃ¼r: darlehen
âœ… Universal Repair abgeschlossen: { originalLength: 3512, repairedLength: 3512, tokens: 2559 }
âœ… Repair-Pass abgeschlossen in 6767ms
ğŸ” Validator gestartet (deterministisch)
âœ… Validator abgeschlossen: { passed: true, score: 0.9, errorsCount: 0, warningsCount: 1 }
ğŸ” Self-Check gestartet
âœ… Self-Check abgeschlossen: { conforms: true, score: 1, notesCount: 0 }
ğŸ”„ Retry 2 Hybrid Score: 0.93 (Validator: 0.9, LLM: 1)
âš ï¸ Quality threshold NOT met after 2 retries. reviewRequired = true
âœ… Generierung (sanitiert) in MongoDB gespeichert: new ObjectId('690e08253af8b8273a9c2cb2')
âœ… Sichere Artefakte (verschlÃ¼sselt) gespeichert
ğŸ‰ V2 Generierung abgeschlossen: {
  durationMs: 87957,
  hybridScore: 0.93,
  validatorScore: 0.9,
  llmScore: 1,
  validatorPassed: true,
  retriesUsed: 2,
  reviewRequired: true,
  contractMetadata: {
    length: 3512,
    paragraphCount: 12,
    preview: '**Darlehensvertrag**\n' +
      '\n' +
      'zwischen\n' +
      '\n' +
      '**Darlehensgeber:**  \n' +
      '[NAME]  \n' +
      'BankstraÃŸe 10  \n' +
      '60311 Frankfurt  \n' +
      '\n' +
      'un...'
  }
}
   âŒ darlehen (standard): Cannot read properties of undefined (reading 'toFixed')

ğŸš€ Starte Test: darlehen (sonderklausel)
ğŸš€ V2 Zwei-Phasen-Generierung gestartet
ğŸ“‹ Vertragstyp: darlehen
ğŸ‘¤ User ID (hash): 507f1f77...
ğŸ“Š Input (sanitiert): {
  parteiA: { exists: true },
  parteiB: { exists: true },
  customRequirements: { length: 184 }
}
ğŸ¯ Quality Threshold: 0.94
ğŸ”„ Phase 1: Meta-Prompt Generation gestartet
ğŸ“‹ Vertragstyp: darlehen
ğŸ‘¥ Rollen: { A: 'Darlehensgeber', B: 'Darlehensnehmer' }
ğŸ“Š Input (sanitiert): {
  parteiA: { exists: true },
  parteiB: { exists: true },
  customRequirements: { length: 184 }
}
ğŸ“‹ Intelligent filtering: 3 â†’ 2 topics (-1 mentioned in input)
âœ… Phase 1 erfolgreich: {
  promptLength: 1565,
  snapshotKeys: [ 'roles', 'mustClauses', 'forbiddenTopics', 'customRequirements' ],
  timingMs: 21108,
  tokens: 2127
}
ğŸ”„ Phase 2: Contract Generation gestartet
ğŸ“ Prompt-LÃ¤nge: 1565
âœ… Phase 2 erfolgreich: {
  textMetadata: {
    length: 3862,
    paragraphCount: 11,
    preview: '**Darlehensvertrag**\n' +
      '\n' +
      'zwischen\n' +
      '\n' +
      '**[NAME]H**, KapitalstraÃŸe 1, 40213 DÃ¼sseldorf\n' +
      '\n' +
      '- nachfolgen...'
  },
  timingMs: 11543,
  tokens: 1439
}
ğŸ”§ Repair-Pass gestartet fÃ¼r: darlehen
âœ… Universal Repair abgeschlossen: { originalLength: 3862, repairedLength: 3862, tokens: 2763 }
âœ… Repair-Pass abgeschlossen in 5147ms
ğŸ” Validator gestartet (deterministisch)
âœ… Validator abgeschlossen: { passed: true, score: 0.9, errorsCount: 0, warningsCount: 1 }
ğŸ” Self-Check gestartet
âœ… Self-Check abgeschlossen: { conforms: true, score: 1, notesCount: 0 }
ğŸ“Š Hybrid Score: 0.93 (Validator: 0.9, LLM: 1)
âš ï¸ Hybrid Score (0.93) < Threshold (0.94), starte Retry 1/2 (Backoff: 1000ms)...
ğŸ”§ Repair-Pass gestartet fÃ¼r: darlehen
âœ… Universal Repair abgeschlossen: { originalLength: 4060, repairedLength: 4068, tokens: 2863 }
âœ… Repair-Pass abgeschlossen in 6838ms
ğŸ” Validator gestartet (deterministisch)
âœ… Validator abgeschlossen: { passed: true, score: 0.9, errorsCount: 0, warningsCount: 1 }
ğŸ” Self-Check gestartet
âœ… Self-Check abgeschlossen: { conforms: true, score: 1, notesCount: 0 }
ğŸ”„ Retry 1 Hybrid Score: 0.93 (Validator: 0.9, LLM: 1)
âš ï¸ Hybrid Score (0.93) < Threshold (0.94), starte Retry 2/2 (Backoff: 2000ms)...
ğŸ”§ Repair-Pass gestartet fÃ¼r: darlehen
âœ… Universal Repair abgeschlossen: { originalLength: 3943, repairedLength: 3953, tokens: 2793 }
âœ… Repair-Pass abgeschlossen in 9089ms
ğŸ” Validator gestartet (deterministisch)
âœ… Validator abgeschlossen: { passed: true, score: 0.9, errorsCount: 0, warningsCount: 1 }
ğŸ” Self-Check gestartet
âœ… Self-Check abgeschlossen: { conforms: true, score: 1, notesCount: 0 }
ğŸ”„ Retry 2 Hybrid Score: 0.93 (Validator: 0.9, LLM: 1)
âš ï¸ Quality threshold NOT met after 2 retries. reviewRequired = true
âœ… Generierung (sanitiert) in MongoDB gespeichert: new ObjectId('690e087b3af8b8273a9c2cb4')
âœ… Sichere Artefakte (verschlÃ¼sselt) gespeichert
ğŸ‰ V2 Generierung abgeschlossen: {
  durationMs: 85516,
  hybridScore: 0.93,
  validatorScore: 0.9,
  llmScore: 1,
  validatorPassed: true,
  retriesUsed: 2,
  reviewRequired: true,
  contractMetadata: {
    length: 3953,
    paragraphCount: 11,
    preview: '**Darlehensvertrag**\n' +
      '\n' +
      'zwischen\n' +
      '\n' +
      '**[NAME]H**, KapitalstraÃŸe 1, 40213 DÃ¼sseldorf\n' +
      '\n' +
      '- nachfolgen...'
  }
}
   âŒ darlehen (sonderklausel): Cannot read properties of undefined (reading 'toFixed')

ğŸš€ Starte Test: darlehen (edge_case)
ğŸš€ V2 Zwei-Phasen-Generierung gestartet
ğŸ“‹ Vertragstyp: darlehen
ğŸ‘¤ User ID (hash): 507f1f77...
ğŸ“Š Input (sanitiert): {
  parteiA: { exists: true },
  parteiB: { exists: true },
  customRequirements: { length: 206 }
}
ğŸ¯ Quality Threshold: 0.94
ğŸ”„ Phase 1: Meta-Prompt Generation gestartet
ğŸ“‹ Vertragstyp: darlehen
ğŸ‘¥ Rollen: { A: 'Darlehensgeber', B: 'Darlehensnehmer' }
ğŸ“Š Input (sanitiert): {
  parteiA: { exists: true },
  parteiB: { exists: true },
  customRequirements: { length: 206 }
}
âœ… Phase 1 erfolgreich: {
  promptLength: 1711,
  snapshotKeys: [ 'roles', 'mustClauses', 'forbiddenTopics', 'customRequirements' ],
  timingMs: 18991,
  tokens: 2138
}
ğŸ”„ Phase 2: Contract Generation gestartet
ğŸ“ Prompt-LÃ¤nge: 1711
âœ… Phase 2 erfolgreich: {
  textMetadata: {
    length: 3210,
    paragraphCount: 10,
    preview: '**Darlehensvertrag**\n' +
      '\n' +
      'zwischen\n' +
      '\n' +
      '**[NAME]**  \n' +
      'FamilienstraÃŸe 5,  \n' +
      '30159 Hannover  \n' +
      '\n' +
      '- nachfol...'
  },
  timingMs: 10830,
  tokens: 1275
}
ğŸ”§ Repair-Pass gestartet fÃ¼r: darlehen
âœ… Universal Repair abgeschlossen: { originalLength: 3210, repairedLength: 3220, tokens: 2393 }
ğŸ”§ Darlehen Edge Case erkannt (0% Zins), starte Spezialisierung...
âœ… Darlehen Specialization abgeschlossen: { tokens: 2054 }
âœ… Repair-Pass abgeschlossen in 10268ms
ğŸ” Validator gestartet (deterministisch)
âœ… Validator abgeschlossen: { passed: true, score: 1, errorsCount: 0, warningsCount: 0 }
ğŸ” Self-Check gestartet
âœ… Self-Check abgeschlossen: { conforms: false, score: 0.8, notesCount: 6 }
ğŸ“Š Hybrid Score: 0.94 (Validator: 1, LLM: 0.8)
âœ… Generierung (sanitiert) in MongoDB gespeichert: new ObjectId('690e08a83af8b8273a9c2cb6')
âœ… Sichere Artefakte (verschlÃ¼sselt) gespeichert
ğŸ‰ V2 Generierung abgeschlossen: {
  durationMs: 43308,
  hybridScore: 0.94,
  validatorScore: 1,
  llmScore: 0.8,
  validatorPassed: true,
  retriesUsed: 0,
  reviewRequired: false,
  contractMetadata: {
    length: 3221,
    paragraphCount: 10,
    preview: '**Darlehensvertrag**\n' +
      '\n' +
      'zwischen\n' +
      '\n' +
      '**[NAME]**  \n' +
      'FamilienstraÃŸe 5,  \n' +
      '30159 Hannover  \n' +
      '\n' +
      '- nachfol...'
  }
}
   âŒ darlehen (edge_case): Cannot read properties of undefined (reading 'toFixed')

================================================================================
ğŸ“Š ZUSAMMENFASSUNG
================================================================================

Total: 6
âœ… Erfolgreich: 0
âŒ Fehlgeschlagen: 6


âŒ FEHLGESCHLAGENE TESTS:

   individuell (standard): Cannot read properties of undefined (reading 'toFixed')
   individuell (sonderklausel): Cannot read properties of undefined (reading 'toFixed')
   individuell (edge_case): Cannot read properties of undefined (reading 'toFixed')
   darlehen (standard): Cannot read properties of undefined (reading 'toFixed')
   darlehen (sonderklausel): Cannot read properties of undefined (reading 'toFixed')
   darlehen (edge_case): Cannot read properties of undefined (reading 'toFixed')

================================================================================
âœ… Test-Run abgeschlossen!
================================================================================

